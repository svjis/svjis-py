{% extends "base-with-aside-menu-content.html" %}

{% load article_filters %}
{% load i18n %}

{% block content %}

<h1 class="page-title">#{{ obj.pk }} - {{ obj.subject }}</h1>

<table width="100%" class="list" width="95%" aria-describedby="tbl-desc">
    <tr>
        <th class="list" width="25%" scope="row">{% trans 'Date' %}</th>
        <td class="list" width="75%">{{ obj.created_date }}</td>
    </tr>
    <tr>
        <th class="list" scope="row">{% trans 'Creator' %}</th>
        <td class="list">{{ obj.created_by_user.first_name }}&nbsp;{{ obj.created_by_user.last_name }}</td>
    </tr>
    <tr>
        <th class="list" scope="row">{% trans 'Resolver' %}</th>
        <td class="list">{{ obj.assigned_to_user.first_name }}&nbsp;{{ obj.assigned_to_user.last_name }}</td>
    </tr>
    <tr>
        <th class="list" scope="row">{% trans 'Closed' %}</th>
        <td class="list">{{ obj.closed }}</td>
    </tr>
    <tr>
        <th class="list" scope="row">{% trans 'Entrance' %}</th>
        <td class="list">{{ obj.entrance.description }} - {{ obj.entrance.address }}</td>
    </tr>
    <tr>
        <th class="list" scope="row">{% trans 'Description' %}</th>
        <td class="list">{{ obj.description | markdown | safe }}</td>
    </tr>
</table>


{% if pk != 0 %}
<h2 class="page-title">{% trans 'Assets' %}</h2>

    {% if assets %}
    <table class="list" aria-describedby="tbl-desc">
        <tr>
            <th class="list" scope="col">&nbsp;</th>
            <th class="list" scope="col">{% trans 'Description' %}</th>
            <th class="list" scope="col">{% trans 'File' %}</th>
            <th class="list" scope="col">{% trans 'User' %}</th>
            <th class="list" scope="col">{% trans 'Time' %}</th>
            <th class="list" scope="col">&nbsp;</th>
        </tr>
        {% for a in assets %}
        <tr>
            <td class="list"><img src="/static/gfx/{{ a.icon }}" border="0" alt="{{ a.basename }}"></td>
            <td class="list" id="asset_name_{{ a.asset.pk }}">{{ a.asset.description }}</td>
            <td class="list" id="asset_file_{{ a.asset.pk }}"><a href="/media/{{ a.asset.file }}">{{ a.basename }}</a></td>
            <td class="list" id="asset_user_{{ a.asset.pk }}">{{ a.asset.created_by_user.first_name }}&nbsp;{{ a.asset.created_by_user.last_name }}</td>
            <td class="list" id="asset_time_{{ a.asset.pk }}">{{ a.asset.created_date }}</td>
            {% if a.asset.created_by_user == user %}
            <td class="list"><a onclick="if (!confirm('{% trans 'Do you want to delete' %} {{ a.asset.description }} ?')) return false;" href="{% url 'faults_fault_asset_delete' pk=a.asset.id %}"><img src="/static/gfx/delete.png" border="0" title="{% trans 'Delete' %}" alt="{% trans 'Delete' %}"></a></td>
            {% else %}
            <td class="list">&nbsp;</td>
            {% endif %}
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    <form action="{% url 'faults_fault_asset_save' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="fault_pk" value="{{ obj.pk }}">

        <fieldset>
            <legend>{% trans 'Assets' %}</legend>
            <p>
                <label class="common-label" for="{{ asset_form.description.auto_id }}">{{ asset_form.description.label }}</label>
                {{ asset_form.description }}
            </p>
            <p>
                <label class="common-label" for="{{ asset_form.file.auto_id }}">{{ asset_form.file.label }}</label>
                {{ asset_form.file }}
            </p>
        </fieldset>
        <p>
            <input class="my-button" id="submit2" type="submit" value="{% trans 'Upload' %}" />
        </p>
    </form>
{% endif %}

{% endblock %}
